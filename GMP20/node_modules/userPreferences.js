var fs = require('fs');
var util = require('util');
var EventEmitter = require("events").EventEmitter;
var _ = require('underscore');
var http = require('https');
var qs = require('querystring');


function UserPreferences(){	
	var player_opts;
	var server_options;
	
	var selectedPlaylist = "normal";
	var unlikedMusics = [];
	var locallist = [];
	
};

util.inherits(UserPreferences, EventEmitter);

UserPreferences.prototype.init = function(player_opts, server_options){
	var self = this;
	self.player_opts = player_opts;
	self.server_options = server_options;
	self.loadPreferences();
}

UserPreferences.prototype.loadPreferences = function(){
	var self = this;
	var data = fs.readFileSync('./data/userdata.json',{encoding:'utf-8',flag:'r'});
	
	if( JSON.parse(data) ){
		var e = self._events;
		_.extend(self, JSON.parse(data));
		self._events = e;
		self.status = 'loaded';
		/*/
		var list = JSON.parse(res_data).data;
		self.emit('loadlist-complete', res_data);
		/*/
	};
}

UserPreferences.prototype.getData = function( property ){
	var self = this;
	return self[property];
}

UserPreferences.prototype.setData = function( property, value ){
	var self = this;
	self[property] = value;
	self.saveData();
}

UserPreferences.prototype.saveData = function( ){
	var self = this;
	var parse = JSON.stringify(self, null, '\t');
	var data = fs.writeFile('./data/userdata.json', parse,{encoding:'utf-8',flag:'w'},function( err ){ 
		if(err){
			console.log("Erro ao salvar preferências");
		} else {
			console.log("Preferências salvas com sucesso");
		}
	});
}

module.exports = new UserPreferences();

